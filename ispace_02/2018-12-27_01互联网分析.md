---
title: 2018-12-27_01互联网分析
---
# 01互联网营销分析
## ETL 部分备份
2018年12月27日 16时51分02秒
60051 订单
``` sql
select A.id
,A.orders_no  -- 订单号
,DATE(A.create_time) create_date -- 订单创建时间 cc：拆分时间和日期
,STR_TO_DATE( CONCAT('2000-01-01',time(A.create_time)) ,'%Y-%m-%d %H:%i:%s') create_time-- 订单创建时间 cc：拆分时间和日期
,A.platform  -- 平台 pc/M
,A.user_id -- 用户id
,A.user_name -- 用户名称
,A.order_states --  'erp订单状态：10-待付定金，20-待约合开工日期，40-待派单，50-待约合排列日期，51-待分配排雷工人，52-待排雷反馈，60-待设计报价状态，90-待审核报价状态，91-待复核报价状态，150-待签约，155-待审核合同，150-已签约，170-施工中，200-已竣工，300-已过期，400-已退款',
 -- ,shop_no -- 门店编码 -- 无数据
,A.area_code -- 门店区域编码
,A.amount  -- 订单表定金
,A.gender  --  '0：女；1：男',
,A.orders_type -- 订单房屋类型：0新1旧
,A.activity_code -- 活动标识
,A.deposit_pay_sign -- 订金支付标识1:订金小于500大于0,2：订金大于等于500  decorate_order_pay 中的金额
-- 20181206(更新渠道对应方案，渠道编号为空的) ,B.source_no as source_no -- 推广渠道编号
,(case when B.source_no is null or B.source_no='' then A.platform else B.source_no end) as source_no -- 推广渠道编号
-- ,C.doc_order_no -- 订单号
,date(C.doc_first_vaild_date) doc_first_vaild_date -- 首次有效时间
,date(C.doc_plan_enter_store_date) doc_plan_enter_store_date -- 预约进店时间
,date(C.doc_enter_store_date) doc_enter_store_date -- 客户进店日期
,C.doc_first_vaild_user -- 首次首次有效人 20181207 
,C.doc_first_vaild_user_code -- 首次首次有效人编号 20181212  worker 表
,E.customer_manager -- 客户经理姓名 20181212 -- decorate_order_bussiness 应该用这张表的
,E.project_manager -- 项目经理姓名 20181212
,E.designer -- 设计师姓名 20181212
,E.customer_manager_no -- '客户经理编号',20181212
,E.project_manager_no --  '项目经理编号',20181212
,E.designer_no -- '设计师编号',20181212
,C.doc_history_kf_code -- 历史客服编号 20181212
,C.doc_order_repeat -- 重复订单，0否，1是   20181212
,C.doc_invalid_confirm_state  -- 无效确认0否1是 20181212
,C.doc_check_num -- 跟进次数 20181212
,D.un_payment_category -- 退款金额
,D.payment_category-- 回款金额
,date(D.payment_date) payment_date -- 交订时间
,date(D.un_payment_date) un_payment_date -- 退订时间
,case when A.deposit_pay_sign = 2 and  D.payment_date is not null then date(D.payment_date) else null end payment_date_500-- 交订满 500 日期
,case when A.deposit_pay_sign = 2 and  D.un_payment_date is not null then date(D.un_payment_date) else null end un_payment_date_500-- 交订满 500 日期
,date(E.contract_date) contract_date -- 实际签约时间
,F.total_amount -- 合同金额
,G.region_id -- 房屋区域
,G.community -- 小区名称
,G.house_category -- 房屋类别
,G.house_type -- 房屋户型
,G.area -- 房屋面积
,G.measure_area -- 实际测量面积 
,G.house_prop -- 房屋属性
,G.house_decorate_state -- 新老房
,G.building_year -- 建造年份（数据字典）

from decorate_order A
LEFT JOIN decorate_order_source B on A.orders_no = B.orders_no
LEFT JOIN decorate_order_check C on A.orders_no = C.doc_order_no
LEFT JOIN 
(select  orders_no
  ,sum(case when payment_category in (6,7,11) then payment_amount else 0 end)  un_payment_category
	, sum(case when payment_category in (6,7,11) then 0 else payment_amount end) payment_category
  , min(case when payment_category in (6,7,11) then null else payment_time end) payment_date
  , min(case when payment_category in (6,7,11) then null else create_time end) create_payment_date  -- 交订创建时间
  , max(case when payment_category in (6,7,11) then payment_time else null end) un_payment_date
  , max(case when payment_category in (6,7,11) then create_time else null end) create_un_payment_date -- 退订单创建时间
  from decorate_order_pay  -- where orders_no	= 'DD20180823000473'
group by orders_no) D on A.orders_no = D.orders_no
LEFT JOIN decorate_order_bussiness E on A.orders_no = E.orders_no
LEFT JOIN decorate_order_amount F on A.orders_no = F.orders_no
LEFT JOIN decorate_order_house G on A.orders_no = G.order_no
-- where A.orders_no	= 'DD20181119001189';
/* 20181213 update 增加字段
select A.id
,A.orders_no  -- 订单号
,DATE(A.create_time) create_date -- 订单创建时间 cc：拆分时间和日期
,STR_TO_DATE( CONCAT('2000-01-01',time(A.create_time)) ,'%Y-%m-%d %H:%i:%s') create_time-- 订单创建时间 cc：拆分时间和日期
,A.platform  -- 平台 pc/M
,A.user_id -- 用户id
,A.order_states --  'erp订单状态：10-待付定金，20-待约合开工日期，40-待派单，50-待约合排列日期，51-待分配排雷工人，52-待排雷反馈，60-待设计报价状态，90-待审核报价状态，91-待复核报价状态，150-待签约，155-待审核合同，150-已签约，170-施工中，200-已竣工，300-已过期，400-已退款',
 -- ,shop_no -- 门店编码 -- 无数据
,A.area_code -- 门店区域编码
,A.amount  -- 定金
,A.gender  --  '0：女；1：男',
,A.orders_type -- 订单房屋类型：0新1旧
,A.activity_code -- 活动标识
,A.deposit_pay_sign -- 订金支付标识1:订金小于500大于0,2：订金大于等于500
-- 20181206(更新渠道对应方案，渠道编号为空的) ,B.source_no as source_no -- 推广渠道编号
,(case when B.source_no is null or B.source_no='' then A.platform else B.source_no end) as source_no -- 推广渠道编号
-- ,C.doc_order_no -- 订单号
,date(C.doc_first_vaild_date) doc_first_vaild_date -- 首次有效时间
,date(C.doc_plan_enter_store_date) doc_plan_enter_store_date -- 预约进店时间
,date(C.doc_enter_store_date) doc_enter_store_date -- 客户进店日期

,C.doc_first_vaild_user -- 首次首次有效人 20181207 
,D.un_payment_category -- 退订金额
,D.payment_category-- 交订金额
,date(D.payment_date) payment_date -- 交订时间
,date(D.un_payment_date) un_payment_date -- 退订时间
,date(E.contract_date) contract_date -- 实际签约时间
,F.total_amount -- 合同金额
,G.region_id -- 房屋区域
,G.community -- 小区名称
,G.house_category -- 房屋类别
,G.house_type -- 房屋户型
,G.area -- 房屋面积
,G.measure_area -- 实际测量面积 
,G.house_prop -- 房屋属性
,G.house_decorate_state -- 新老房
,G.building_year -- 建造年份（数据字典）

from decorate_order A
LEFT JOIN decorate_order_source B on A.orders_no = B.orders_no
LEFT JOIN decorate_order_check C on A.orders_no = C.doc_order_no
LEFT JOIN 
(select  orders_no, sum(case when payment_category in (6,7,11) then payment_amount else 0 end)  un_payment_category
	, sum(case when payment_category in (6,7,11) then 0 else payment_amount end) payment_category
  , min(case when payment_category in (6,7,11) then null else payment_time end) payment_date
  , max(case when payment_category in (6,7,11) then payment_time else null end) un_payment_date
  from decorate_order_pay -- where orders_no	= 'DD20180823000473'
group by orders_no) D on A.orders_no = D.orders_no
LEFT JOIN decorate_order_bussiness E on A.orders_no = E.orders_no
LEFT JOIN decorate_order_amount F on A.orders_no = F.orders_no
LEFT JOIN decorate_order_house G on A.orders_no = G.order_no;
*/
```
61001 日期
``` sql
select '2012-01-01' as Date
```

61002 推广渠道
``` sql
使用excel上传平台进行更新
```

61003 用户信息
``` sql
select user_id , name from user_info;
```

61004 订单状态
``` sql
SELECT
order_states -- 合同状态编码
,interior_name -- 对内显示名称
,outside_name -- 对外显示名称
,state -- '是否可用状态 0 可用 1 不可用',
FROM decorate_order_state
```

61005 区域
``` sql
select area_code 
,REPLACE(group_name,'默认组','') group_name 
,REPLACE(group_name,'体验店默认组','') city 
,case  when group_name in ('北京体验店默认组','上海体验店默认组','广州体验店默认组','深圳体验店默认组') then '第一方面军' else
			case when group_name in ('郑州体验店默认组','西安体验店默认组','成都体验店默认组','天津体验店默认组') then '第二方面军' else 
						case when group_name in ('苏州体验店默认组','武汉体验店默认组','重庆体验店默认组','杭州体验店默认组') then '第三方面军' else 
										case when group_name in ('廊坊体验店默认组','昆明体验店默认组','哈尔滨体验店默认组','南京体验店默认组','济南体验店默认组','南昌体验店默认组','太原体验店默认组') then '第四方面军' else 
										'其他方面军' end
						end
		end
 end front_name		
 from im_default_group;

```

61006 房屋区域表
``` sql
select 
id
,name
,region_type
,parent_id
,code
,full_name
,state
from region;
```

60051
``` sql

```

60051
``` sql

```

60051
``` sql

```

60051
``` sql

```


