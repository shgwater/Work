---
title:  数据中心工作记录
tags: 爱空间,数据中心
grammar_cjkRuby: true
---

[toc!]

# 2019-10-9数据中心会议
## 现有工作回顾


### 精准营销

a. 目录划分，现阶段按照功能划分，未来可能按照角色比较好。
b. 还涉及部分门店的。

### 成本分析

刚开始做的时候忽略了实际的部分。
遇到的最大的困难，规则不明确。

eg1. 财务正常结算需要做的动作。每月归集。
材料成本归集：将下面的过程使用数据库完成。
工人成本归集：
管家成本归集：

之前的做法：建立合同台账，里面有合同号，其中就有**材料成本**需要取出入库报表每个合同号查询。

eg2. 财务每月结账（把每个竣工的合同，确定收入和各个部分成本）。
结账需要 收入（合同收入、变更、抵价款等）、材料成本（由于某些实际原因，项目竣工之后还产生项目发货等）、工人成本、管家成本准确。

结账后（售后）

问题1 ： 没有一个确定的标志性的结账的时间（现在用的是导入的记账月，未来她们会创建一个‘管家账单确认月’），需要完全与财务保持一致。

问题2： 税率，税率调整和合并合同调整的问题。现在ERP系统中没有历史税率信息。未来可能也使用手工台账导入。

## 未来工作计划

要与数仓1.0密切合作。
完整看下来现有报表，我们思考一个问题，**缺什么** 或者说未来怎么做。

### 营销体系（从现在到十一月中旬）

-  首先数据要做准。
1. 前段时间对数据差异做了一个系统的梳理。
2. 但是对于整个报表体系还没有系统的梳理。
3. 所有报表进行一轮检查，有问题的清理，同时整理目录结构。
4. 缺少门店的报表。
5. 报表优化，现有报表在现有条件下做到最好。

### 后续
采购、物流、售后、工程、交付管理、财务。

### 现有整体架构

五层：报表设计（展现层）
四层：数云体系  业务建模（建立查询、公共维度、公式、块属性等）
三层：数云体系  数据模型（事实表维度表、语义层）
二层：数云体系  数仓 通过 ETL生成 （Sqlserver）
一层： 实时备份库  （Mysql /Sqlserver数据库)
底层： ERP   EAS    HRS     OA   等



# 2019年10月10日  数云与BI差异说明及处理

1、每个字段的取值位置与BI是否相同。
2、大的取值逻辑，模型的取值逻辑。
3、订单明细的首次渠道的定义，是否需要追溯到最早，还是需要订一个时间段。现阶段是全库去重。

备忘：to 小雪。由于取数逻辑导致的维度的差异，如果可以在报表层面展示出来的话就全部给展示出来。

一、精准营销模块
  现阶段用户穿刺表的维度现在都是取得首次订单维度。需要确定维度聚合时怎样取到最有效的信息。
eg.假设现在有同一个用户同时装两套房子，那么我们怎么来取数？
  

Q1：确定好主体，一个人一套房的一次装修。将该主体的一系列订单汇集在一起，如何取主体的聚合维度？
 A1_1: 明细订单放上主体的首次订单的维度信息。
 A1_2：同一个user_id可以去重，但是同一个user_id如何/什么时候区分业务主体。


Q2：如何准确的确定每个用户的各个阶段的首次。
  A2_1:周芳： 首次预约时间、首次有效时间（该用户所有有效时间的最早有效时间）、首次到店时间（该用户所有到店时间的最早到店时间）。、


Q3: 不同的取数方式的规则，以及可能产生的差异？

Q4: 首次预约的信息和用户最有效信息的区别。

Q5: 建立重复订单的表，来推动业务标记的优化。

Q6: 回款表已经改成了fms里的回款表，提前做好切换数据源的准备。

Q7: 用户穿刺表&订单明细表的四个金额与周芳核对。

Q8: to 大宝：订单核实状态我是怎么取的？二级状态我是怎么取的？

Q9: 哪些数据会随着时间呈现出不稳定状态。其中又有哪些是需要固定数据来进行考核的。



## 问题记录

1. 订单状态时间与实际业务逻辑不符，比如还未交订就排了设计师。
2. 客户交订换号之后，到店时间比交订时间晚，时间错位。
3. **需修改用户穿刺表的订单最有效信息（维度）。**
4. 主要 数仓与数云更新时间、数据一致。
5. 如果要关闭老BI，有部分数据需要实时查看。区分实时的报表和分析型的报表。
6. 同一个用户的多条订单，有效信息分散在各个订单上。
7. **在做数据处理时需要明确规则，并且记录且公布出来。**
8. **跟进一个用户有多个手机号的问题 with 周芳姐**
9. 当订单状态为10的时候金额不取 with 周芳姐。
10. **历史数据存储，部分报表历史存储 with 数云。**
11. 分类整理，crm需要处理的，数据中心需要处理的问题。
12. 一天两次更新的问题，会导致与其他系统之间出现问题。
13. 梳理需要实时进行更新的报表。

### 一个半月的时间对现有问题进行规划。
 我处需要进行处理的内容有：
 
-  all day 数云现有取数逻辑整理成文档。**后续在做数据处理时需要明确规则，并且记录且公布出来。**
-   3 day **需修改用户穿刺表的订单最有效信息（维度）。**
-   3 day 同一个客户有可能会修改手机号，这部分怎么处理，与周芳姐沟通。
-   固定指标类的数据，**需要对历史数据存储，部分报表历史存储 with 数云。**
-   数仓数云保持数据一致（包括明细数据、更新时间等）
-   取用  退订时间  的规则未确认 with 周芳姐，浩哥。

## 底层架构套路

### 数云数仓底层逻辑核对

数仓的实时计算需要耗费内存，不能有太多的实时任务。
**查看现有数仓的数据结果。**


# 2019年10月11日 财务知识简介

## 数云eas数据结构
一笔凭证包括
- 机构（主体） 某某公司
- 记账日期和业务日期有可能不同，但是尽量是月份相同。强调会计期间。
- 凭证号  （顺着来的）
- 会计分录
- - 摘要，基本说明。eg.支付8月材料款。
- - 科目，分类方法（看资产负债表） eg. 220201 应付账款_应付账款-供应商  100201 银行存款_人民币。
- - 借方，资产类科目  增加 （了解一借多贷）
- - 贷方，负债类科目  增加
``` 
借贷方向说明
资产类科目：借方增加 贷方减少
负债类科目：借方减少 贷方增加
成本类科目：借方增加 贷方减少
损益类科目：收入 借方减少 贷方增加
                      成本和费用 借方增加 贷方减少
```
- 三大报表  
- - 资产负债表 企业的资产权益的情况。 一般左边是资产，右上是负债，右下是所有者权益。
- - 损益表（利润表）。成本费用的区别。
- - 现金流量表 。企业现金情况的说明。
- 报表项目是部分科目的合并。

| | a | b |
| --- | --- | --- |
| 金额 | 10 | 20 | |

|     |     |
| --- | --- |
|     |     |


# 2019年10月15日 数据中心梳理
## 系统过多
到现在为止，一共有BI、数仓、数云三个系统，使用的话需要三方面数据统一，不利于使用使用以及维护。

数仓是比较好的用大数据的方式完成的，数云是比较好的完成了分析模型的建立，现在来思考如何整合大数据和分析模型（包括计算和展现）。

## 整合系统
###  技术方案第一阶段
- 主要工作内容
- -  抽取spark的结果表（mysql）到现有的sqlserver中。依托现有的产品来整合，将ETL处理下沉到黄磊部分。这样的数仓和数云的基础数据相同，省去很多核对工作。
- - 现有BI不可代替的地方有两方面，一个是模块全面，一个是实时性的要求，还有移动性的要求。
- - 现在还缺少哪些模块（和BI相比），争取迁移到数仓或者数云中。
- - 元数据的管理dataphin（类似的开源软件）。


| 模块 |   内容	 |  工作分配   |
| --- | --- | --- |
| 交付管理 | 现有bi和数云报表梳理    |     |
 | 交付管理 | 现有bi和数云底层模型梳理    |     |
 - 主要工作内容
 - - **一起梳理交付管理的模型，给黄磊去做。我来牵头以交付管理文档中心，周芳补充。（十月份）**
 - - CRM（精准营销 callcenter 门店 火炬 新零售）部分。周芳牵头，两方模型核对。之后做报表级别的核对，看缺少哪些字段。
 - - 我的工作，与黄磊沟通，了解现有精准营销他们是怎么做的，看看有没有办法跟数云的模型结合。
 - - 剩下的模块（采购 物流 售后 交付 财务 基本信息 设计师系统），整理剩余模块BI和数云两边的字段，看有哪些需要快速上来使用。提供出来，由我和老邓商量建立模型在数云中展示。
 - - **注意学习的spark的抽取，分担黄磊的工作量。**
 
###  技术方案第二阶段
- 主要方向
- - 大数据版的分析云上线，需要进行测试、迁移等工作。明年三月份提供评估结论。
- - spark工作方式以及计算方式，在后期的瓶颈在什么地方。

## 其他事项

- 要注意元数据管理。 （目的：明确规则，减少歧义） 
- 与需求段的接口，与技术的接口，内部的接口。
- to 小雪：数云的移动端要开始尝试使用了。主要是整体性的报表（可咨询周芳姐）。
- 精准营销的费用数据的接口。
- 数据中台的规划（明年的主要工作）。



# 2019年10月15日CRM营销梳理
## 获客
指标：ROI 投入产出  转化效率  等
1. 线上 通过pv uv等深入分析。分渠道的分析逻辑不同。
2. 线下 

## 门店管理
指标：预算实际比、响应效率、工作效益、回款、等
1. 获客管理
2. 绩效管理（人、小组、门店）

## 新零售
1. 火炬
2. 一站式（索菲亚）



2019年10月18日

老客户数据
1. 邀请客户数：只要有客户经理就记作一个邀请客户。
- 老客户邀请客户数：老客户列表的话  邀请客户数：应该是新客户表o_pid对应老客户表id，则+1 OK
- 客户经理邀请客户数：客户经理列表的话  邀请客户数：应该是老客户表m_pid对应客户经理表id，则+1   OK

2. 实际报名数（该老客户下有多少新客户报名数）：是老客户的下线，且有手机号 OK
3. 交订人数（看的是新客户的交订人数）：新客户用户编码在 user_info表中platform in (17,77) 的。该用户的所有订单中有交订的。 OK
4. 签约人数（看的是新客户的签约人数）：新客户用户编码在 user_info表中platform in (17,77) 的。该用户的所有订单中有签约的。 OK
5. 交订客户加入数（原来的订单客户加入数。老客户的信息，老客户交订数）：首先看老客户是否交订（用手机号找user_id，然后关联订单数据）。 OK
6. 新客户扫码数：新客户表有数据就算。 OK
7. 交订时间、签约时间：新客户用户编码在 user_info表中platform in (17,77) 的新客户订单交订时间和签约时间取首次时间。 OK



# 2019年10月21日 dataphin元数据管理相关

## 数仓构建整体流程

- 数据调研
- - 业务调研  要看这个业务的本质是什么，为后续准备。
- - 需求分析
- 数据域的划分（商品域、交易域、会员域 用来存放不同意义的指标*）
- 构架总线矩阵
- 构建明细模型
- - 构建dim维度模型。
- - 构建DWD事实模型。
- 构建汇总模型
- 明确统计指标
- - 明确原子指标和派生指标。
- 数仓优化
- 数据验证＆应用


# 2019年10月29日 数据中心会议

## 数据中心多系统人员融合

### 迁移与融合

1. 现阶段迁移已经迁移用户表一般，剩余工作量大概3个用户表。
2. 实时性要求：回款、任务指标（交定签约）。从黄磊这边走的话卡夫卡还是内存计算（是否需要内存日志？需要技术如何配合？）？确定一个实时查询的方案（日志查询实现较为复杂）。或者现在在老BI上继续维护？  -- 2019年10月29日 dh 暂定由周芳姐来维护，优化sql效率。
3. 

## 数据中心工作进度

1. 精准营销按照城市做表分区。
2. 多用户之后并发量的问题。
3. 调整到交付管理上。
4. 索菲亚等新零售的一站式现有模型无法体现。
5. 命名规则以及取值规则规范。
6. 现有模型的字段导出和报表中使用的字段。to 姚健

- 营销端工作
- - 一站式和火炬计划整体逻辑与现有模型调整。
- - 报表的结构组织呈现。
- - 优化，多查询，大数据量等的优化。