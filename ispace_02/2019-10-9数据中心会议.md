---
title:  数据中心工作记录
tags: 爱空间,数据中心
grammar_cjkRuby: true
---
[toc!]

# 2019-10-9数据中心会议
## 现有工作回顾

### 精准营销

a. 目录划分，现阶段按照功能划分，未来可能按照角色比较好。
b. 还涉及部分门店的。

### 成本分析

刚开始做的时候忽略了实际的部分。
遇到的最大的困难，规则不明确。

eg1. 财务正常结算需要做的动作。每月归集。
材料成本归集：将下面的过程使用数据库完成。
工人成本归集：
管家成本归集：

之前的做法：建立合同台账，里面有合同号，其中就有**材料成本**需要取出入库报表每个合同号查询。

eg2. 财务每月结账（把每个竣工的合同，确定收入和各个部分成本）。
结账需要 收入（合同收入、变更、抵价款等）、材料成本（由于某些实际原因，项目竣工之后还产生项目发货等）、工人成本、管家成本准确。

结账后（售后）

问题1 ： 没有一个确定的标志性的结账的时间（现在用的是导入的记账月，未来她们会创建一个‘管家账单确认月’），需要完全与财务保持一致。

问题2： 税率，税率调整和合并合同调整的问题。现在ERP系统中没有历史税率信息。未来可能也使用手工台账导入。

## 未来工作计划

要与数仓1.0密切合作。
完整看下来现有报表，我们思考一个问题，**缺什么** 或者说未来怎么做。

### 营销体系（从现在到十一月中旬）

-  首先数据要做准。
1. 前段时间对数据差异做了一个系统的梳理。
2. 但是对于整个报表体系还没有系统的梳理。
3. 所有报表进行一轮检查，有问题的清理，同时整理目录结构。
4. 缺少门店的报表。
5. 报表优化，现有报表在现有条件下做到最好。

### 后续
采购、物流、售后、工程、交付管理、财务。

### 现有整体架构

五层：报表设计（展现层）
四层：数云体系  业务建模（建立查询、公共维度、公式、块属性等）
三层：数云体系  数据模型（事实表维度表、语义层）
二层：数云体系  数仓 通过 ETL生成 （Sqlserver）
一层： 实时备份库  （Mysql /Sqlserver数据库)
底层： ERP   EAS    HRS     OA   等



# 2019年10月10日  数云与BI差异说明及处理

1、每个字段的取值位置与BI是否相同。
2、大的取值逻辑，模型的取值逻辑。
3、订单明细的首次渠道的定义，是否需要追溯到最早，还是需要订一个时间段。现阶段是全库去重。

备忘：to 小雪。由于取数逻辑导致的维度的差异，如果可以在报表层面展示出来的话就全部给展示出来。

一、精准营销模块
  现阶段用户穿刺表的维度现在都是取得首次订单维度。需要确定维度聚合时怎样取到最有效的信息。
eg.假设现在有同一个用户同时装两套房子，那么我们怎么来取数？
  

Q1：确定好主体，一个人一套房的一次装修。将该主体的一系列订单汇集在一起，如何取主体的聚合维度？
 A1_1: 明细订单放上主体的首次订单的维度信息。
 A1_2：同一个user_id可以去重，但是同一个user_id如何/什么时候区分业务主体。


Q2：如何准确的确定每个用户的各个阶段的首次。
  A2_1:周芳： 首次预约时间、首次有效时间（该用户所有有效时间的最早有效时间）、首次到店时间（该用户所有到店时间的最早到店时间）。、


Q3: 不同的取数方式的规则，以及可能产生的差异？

Q4: 首次预约的信息和用户最有效信息的区别。

Q5: 建立重复订单的表，来推动业务标记的优化。

Q6: 回款表已经改成了fms里的回款表，提前做好切换数据源的准备。

Q7: 用户穿刺表&订单明细表的四个金额与周芳核对。

Q8: to 大宝：订单核实状态我是怎么取的？二级状态我是怎么取的？

Q9: 哪些数据会随着时间呈现出不稳定状态。其中又有哪些是需要固定数据来进行考核的。


## 问题记录

1. 订单状态时间与实际业务逻辑不符，比如还未交订就排了设计师。
2. 客户交订换号之后，到店时间比交订时间晚，时间错位。
3. **需修改用户穿刺表的订单最有效信息（维度）。**
4. 主要 数仓与数云更新时间、数据一致。
5. 如果要关闭老BI，有部分数据需要实时查看。区分实时的报表和分析型的报表。
6. 同一个用户的多条订单，有效信息分散在各个订单上。
7. **在做数据处理时需要明确规则，并且记录且公布出来。**
8. **跟进一个用户有多个手机号的问题 with 周芳姐**
9. 当订单状态为10的时候金额不取 with 周芳姐。
10. **历史数据存储，部分报表历史存储 with 数云。**
11. 分类整理，crm需要处理的，数据中心需要处理的问题。
12. 一天两次更新的问题，会导致与其他系统之间出现问题。
13. 梳理需要实时进行更新的报表。

### 一个半月的时间对现有问题进行规划。
 我处需要进行处理的内容有：
 
-  数云现有取数逻辑整理成文档。**后续在做数据处理时需要明确规则，并且记录且公布出来。**
-   **需修改用户穿刺表的订单最有效信息（维度）。**
-   同一个客户有可能会修改手机号，这部分怎么处理，与周芳姐沟通。
-   固定指标类的数据，**需要对历史数据存储，部分报表历史存储 with 数云。**
-   数仓数云保持数据一致（包括明细数据、更新时间等）
-   取用  退订时间  的规则未确认 with 周芳姐，浩哥。

## 底层架构套路

### 数云数仓底层逻辑核对

数仓的实时计算需要耗费内存，不能有太多的实时任务。
**查看现有数仓的数据结果。**




