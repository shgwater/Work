---
title: 2019-12-5工作代码临时记录
tags: 新建,模板,小书匠
grammar_cjkRuby: true
---


# 日常记录
## 指标集
### 2019年12月5日 
``` sql
-- 周期 年

select DATEPART(year, date) as cycle_name -- 周期
,da.city
from Dim_Time dt 
left join dim_area da on 1=1 
group by 
	DATEPART(year, date)
	,da.city

select * from DIM_AREA da 
where state = '营业'


-- r9 回款金额
select DATEPART(year, fdop.create_time) as cycle_name -- 周期
			,datepart(year,DATEADD(year, -1, fdop.create_time)) as TB_cycle_name -- 同比周期
			,datepart(year,DATEADD(year, -1, fdop.create_time)) as HB_cycle_name -- 环比周期
			,'year' as cycle_type -- 周期类型
			,da.city as city -- 城市
			,dps.second_busness_classified as source_name -- 二级业务范围归类（风控）
			,sum(payment_amount) as payment_amount -- 回款金额
from fact_decorate_order_pay fdop
left join dim_time dt on CQONVERT(nvarchar(10), (fdop.create_time), 120 ) = dt.date
left join Dim_Promotion_Source dps on fdop.source_no = dps.code 
left join DIM_AREA da on fdop.area_code = da.area_code
group by 
			DATEPART(year, fdop.create_time) 
			,datepart(year,DATEADD(year, -1, fdop.create_time))
			,datepart(year,DATEADD(year, -1, fdop.create_time))
			,da.city 
			,dps.second_busness_classified;











-- r10 回款目标
-- 全渠道
select DATEPART(year,fqy.quota_year) as cycle_name -- 周期
			,datepart(year,DATEADD(year, -1,fqy.quota_year)) as TB_cycle_name -- 同比周期
			,datepart(year,DATEADD(year, -1,fqy.quota_year)) as HB_cycle_name -- 环比周期
			,'year' as cycle_type -- 周期类型
			,da.city as city -- 城市
			,'全渠道' as source_name -- 二级业务范围归类（风控）
			,sum(fqy.quota_payback) as payment_amount_target -- 回款目标
from fact_quota_year fqy
left join DIM_AREA da on fqy.quota_store_no=da.area_code
group by DATEPART(year,fqy.quota_year) 
			,datepart(year,DATEADD(year, -1,fqy.quota_year))
			,datepart(year,DATEADD(year, -1,fqy.quota_year))
			,da.city
	

select * from fact_quota_year


```